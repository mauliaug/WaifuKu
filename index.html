<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Novel Game</title>
    <link rel="stylesheet" href="">
    <style>
        
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial', sans-serif; }
body { display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg, #2c3e50, #4a69bd); overflow: hidden; }
.loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #2c3e50, #4a69bd); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; transition: opacity 0.5s ease-out; }
.loading-bar-container { width: 300px; height: 20px; background-color: rgba(255, 255, 255, 0.2); border-radius: 10px; margin-top: 20px; overflow: hidden; }
.loading-bar { height: 100%; width: 0%; background: linear-gradient(90deg, #3498db, #9b59b6); border-radius: 10px; transition: width 0.2s ease; }
.loading-text { color: white; font-size: 24px; margin-top: 20px; letter-spacing: 1px; }
.setup-screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #2c3e50, #4a69bd); flex-direction: column; justify-content: center; align-items: center; z-index: 9990; }
.setup-form { background-color: rgba(255, 255, 255, 0.9); border-radius: 15px; padding: 30px; width: 90%; max-width: 500px; text-align: center; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); transition: transform 0.3s ease, opacity 0.3s ease; }
.setup-form h2 { margin-bottom: 20px; color: #2c3e50; font-size: 24px; }
.form-group { margin-bottom: 15px; text-align: left; }
.form-group label { display: block; margin-bottom: 5px; color: #2c3e50; font-weight: bold; }
.form-control { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; transition: border 0.3s; }
.form-control:focus { outline: none; border-color: #3498db; }
.gender-select { display: flex; justify-content: space-between; margin: 20px 0; }
.gender-option { display: flex; flex-direction: column; align-items: center; width: 45%; cursor: pointer; transition: transform 0.2s; }
.gender-option:hover { transform: scale(1.05); }
.gender-option img { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid transparent; }
.gender-option.selected img { border-color: #3498db; }
.gender-option p { margin-top: 10px; font-weight: bold; color: #2c3e50; }
.setup-nav { display: flex; justify-content: space-between; margin-top: 20px; }
.btn { padding: 12px 25px; border: none; border-radius: 5px; font-size: 16px; cursor: pointer; transition: all 0.3s; font-weight: bold; }
.btn-primary { background-color: #3498db; color: white; }
.btn-primary:hover { background-color: #2980b9; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
.btn-secondary { background-color: #95a5a6; color: white; }
.btn-secondary:hover { background-color: #7f8c8d; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
.welcome-screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; flex-direction: column; justify-content: center; align-items: center; z-index: 9980; color: white; text-align: center; }
.welcome-screen h1 { font-size: 36px; margin-bottom: 20px; animation: fadeInUp 1s ease; }
.welcome-screen p { font-size: 18px; max-width: 600px; margin-bottom: 30px; animation: fadeInUp 1s ease 0.3s backwards; }
.welcome-video { width: 100%; max-width: 800px; max-height: 80vh; margin-top: 20px; display: none; }
@keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
.smartphone { position: relative; width: 360px; height: 720px; margin: auto; border: 16px solid black; border-top-width: 60px; border-bottom-width: 60px; border-radius: 36px; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4); transition: all 0.5s; opacity: 0; transform: translateY(50px); display: none; }
.smartphone.active { opacity: 1; transform: translateY(0); }
.smartphone:before { content: ''; display: block; width: 60px; height: 5px; position: absolute; top: -30px; left: 50%; transform: translateX(-50%); background: #333; border-radius: 10px; }
.smartphone:after { content: ''; display: block; width: 35px; height: 35px; position: absolute; left: 50%; bottom: -50px; transform: translateX(-50%); background: rgba(0, 0, 0, 0.1); border-radius: 50%; border: 2px solid #333; }
.smartphone .camera { width: 10px; height: 10px; position: absolute; top: -35px; left: 120px; background: #333; border-radius: 50%; }
.smartphone .speaker { width: 60px; height: 5px; position: absolute; top: -30px; left: 160px; background: #333; border-radius: 10px; }
.smartphone .content { display: flex; flex-direction: column; width: 100%; height: 100%; background-color: #f5f5f5; overflow: hidden; position: relative; }
.statusbar {
  height: 25px;
  background-color: #333;
  color: white;
  display: flex;
  justify-content: space-between; /* Tetap gunakan untuk status bar */
  align-items: center;
  padding: 0 15px;
  font-size: 12px;
}

.statusbar .time {
  font-weight: bold;
}

.statusbar .info {
  display: flex;
  align-items: center;
  justify-content: flex-end; /* Mengatur info ke ujung kanan */
}

.statusbar .info span {
  margin-left: 8px;
}

.user-info { order: 1; background-color: #4a69bd; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); }
.user-info .left { display: flex; flex-direction: column; }
.user-info .name { font-size: 18px; font-weight: bold; }
.user-info .stats { display: flex; margin-top: 5px; }
.user-info .stat { margin-right: 15px; font-size: 14px; }
.user-info .stat i { margin-right: 5px; }
.app-grid { order: 2; display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; padding: 20px; }
.app-button { display: flex; flex-direction: column; align-items: center; text-align: center; background-color: white; padding: 15px; border-radius: 10px; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1); transition: transform 0.2s, box-shadow 0.2s; }
.app-button:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); }
.app-button i { font-size: 30px; margin-bottom: 10px; color: #4a69bd; }
.app-button .title { font-weight: bold; color: #333; }
.navbar { position: absolute; bottom: 0; width: 100%; height: 60px; background-color: white; display: flex; justify-content: space-around; align-items: center; box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1); }
.nav-button { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: #777; font-size: 12px; transition: color 0.2s; padding: 10px; }
.nav-button i { font-size: 24px; margin-bottom: 3px; }
.nav-button.active, .nav-button:hover { color: #4a69bd; }
.screen { position: absolute; top: 25px; left: 0; width: 100%; height: calc(100% - 85px); background-color: white; display: none; overflow: auto; }
.screen.active { display: block; animation: fadeIn 0.3s ease; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
.back-button { position: absolute; top: 10px; left: 10px; background: rgba(0, 0, 0, 0.1); border: none; width: 40px; height: 40px; border-radius: 50%; display: flex; justify-content: center; align-items: center; color: #333; font-size: 18px; cursor: pointer; z-index: 100; transition: background 0.2s; }
.back-button:hover { background: rgba(0, 0, 0, 0.2); }
.messages-list { list-style: none; padding: 15px; }
.contact-item { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid #eee; transition: background 0.2s; cursor: pointer; }
.contact-item:hover { background-color: #f5f5f5; }
.contact-avatar { width: 50px; height: 50px; border-radius: 50%; margin-right: 15px; object-fit: cover; }
.contact-name { font-weight: bold; margin-bottom: 5px; }
.contact-preview { color: #777; font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.chat-container { display: none; flex-direction: column; height: 100%; }
.chat-choices-container { position: absolute; bottom: 60px;  left: 0; width: 100%; background-color: rgba(255, 255, 255, 0.9); padding: 15px; display: none; /* Awalnya disembunyikan */ }
.chat-header { padding: 15px; background-color: #4a69bd; color: white; display: flex; align-items: center; }
.chat-avatar { width: 40px; height: 40px; border-radius: 50%; margin-right: 15px; object-fit: cover; }
.chat-messages { flex: 1; padding: 15px; overflow-y: auto; background-color: #f5f5f5; }
.message { margin-bottom: 15px; display: flex; }
.message.received { justify-content: flex-start; }
.message.sent { justify-content: flex-end; }
.message-bubble { max-width: 70%; padding: 10px 15px; border-radius: 18px; }
.message.received .message-bubble { background-color: white; border: 1px solid #ddd; }
.message.sent .message-bubble { background-color: #4a69bd; color: white; }
.message-time { font-size: 12px; color: #777; margin-top: 5px; }
.chat-input { display: flex; padding: 10px; background-color: white; border-top: 1px solid #eee; }
.chat-input input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 20px; margin-right: 10px; }
.chat-input button { background-color: #4a69bd; color: white; border: none; width: 40px; height: 40px; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; }
.settings-screen, .work-screen, .notes-screen, .squegram-screen, .memory-screen, .gallery-screen { padding: 20px; background-color: #f5f5f5;  border-radius: 10px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); }
.screen-title { text-align: center; margin-bottom: 20px; color: #333; font-size: 24px; font-weight: bold; }
.settings-option { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #eee; border-bottom: 1px solid }
.settings-option .label { font-weight: bold; color: #4a69bd; }
.settings-option .value { color: #777; }
.toggle-switch { position: relative; display: inline-block; width: 50px; height: 24px; }
.toggle-switch input { opacity: 0; width: 0; height: 0; }
.toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
.toggle-slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
input:checked + .toggle-slider { background-color: #4a69bd; }
input:checked + .toggle-slider:before { transform: translateX(26px); }
.job-list { display: flex; flex-direction: column; gap: 15px; }
.job-card { background-color: white; border-radius: 10px; padding: 15px; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1); }
.job-card .title { font-weight: bold; margin-bottom: 5px; }
.job-card .description { color: #777; margin-bottom: 10px; font-size: 14px; }
.job-card .details { display: flex; justify-content: space-between; font-size: 14px; }
.job-card .salary { color: #4a69bd; font-weight: bold; }
.job-card .energy { color: #e74c3c; }
.btn-work { background-color: #4a69bd; color: white; padding: 8px 15px; border: none; border-radius: 5px; margin-top: 10px; cursor: pointer; transition: background 0.2s; }
.btn-work:hover { background-color: #3a539b; }
.note-card { background-color: white; border-radius: 10px; padding: 15px; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1); margin-bottom: 15px; }
.note-card .title { font-weight: bold; margin-bottom: 10px; }
.note-card .content { color: #555; }
.add-note-btn { position: fixed; bottom: 80px; right: 20px; background-color: #4a69bd; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; cursor: pointer; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2); }
.squegram-post { background-color: white; border-radius: 10px; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1); margin-bottom: 20px; overflow: hidden; }
.squegram-post .header { display: flex; align-items: center; padding: 10px; }
.squegram-post .avatar { width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; }
.squegram-post .username { font-weight: bold; }
.squegram-post .image { width: 100%; height: 200px; object-fit: cover; }
.squegram-post .actions { display: flex; padding: 10px; }
.squegram-post .action-btn { margin-right: 15px; font-size: 20px; color: #555; cursor: pointer; }
.squegram-post .likes { padding: 0 10px 5px; font-weight: bold; font-size: 14px; }
.squegram-post .caption { padding: 0 10px 10px; font-size: 14px; }
.memory-episodes { display: flex; flex-direction: column; gap: 15px; }
.memory-episode { background-color: white; border-radius: 10px; padding: 15px; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1); cursor: pointer; transition: transform 0.2s; }
.memory-episode:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); }
.memory-episode .title { font-weight: bold; margin-bottom: 5px; }
.memory-episode .description { color: #777; font-size: 14px; }
.gallery-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
.gallery-item { position: relative; height: 150px; border-radius: 10px; overflow: hidden; cursor: pointer; }
.gallery-item img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s; }
.gallery-item:hover img { transform: scale(1.05); }
.choices-container { position: absolute; bottom: 0; left: 0; width: 100%; background-color: rgba(255, 255, 255, 0.9); padding: 15px; display: none; }
.choice-btn { display: block; width: 100%; padding: 12px; margin-bottom: 10px; background-color: #4a69bd; color: white; border: none; border-radius: 5px; text-align: left; cursor: pointer; transition: background 0.2s; }
.choice-btn:hover { background-color: #3a539b; }
.dialog-container { position: absolute; bottom: 0; left: 0; width: 100%; background-color: rgba(0, 0, 0, 0.8); padding: 15px; color: white; display: none; }
.dialog-name { font-weight: bold; margin-bottom: 5px; color: #3498db; }
.dialog-text { margin-bottom: 10px; line-height: 1.4; }
.dialog-next { text-align: right; font-style: italic; color: #ddd; }
.notification-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); width: 100%;max-width: 400px; z-index: 1000; display: flex; justify-content: center; flex-direction: column; align-items: center; }
.notification { background-color: #fff; color: #333; padding: 10px 20px; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); width: 100%; max-width: 400px; margin-bottom: 10px; cursor: pointer; transition: transform 0.5s ease, opacity 0.5s ease; }
.visual-novel-screen { width: 100%; height: 100%; background-size: cover; background-position: center; position: relative; display: none; }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
.pulse { animation: pulse 1s infinite; }
@keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }
.shake { animation: shake 0.5s; }
@keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
.bounce { animation: bounce 1s; }
@keyframes slideInLeft { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
.slide-in-left { animation: slideInLeft 0.5s forwards; }
@keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
.slide-in-right { animation: slideInRight 0.5s forwards; }
@keyframes fadeInUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
.fade-in-up { animation: fadeInUp 0.5s forwards; }
@keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
.rotate { animation: rotate 2s linear infinite; }
@keyframes flash { 0%, 50%, 100% { opacity: 1; } 25%, 75% { opacity: 0.5; } }
.flash { animation: flash 1s; }

    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen">
        <i class="fas fa-gamepad fa-5x" style="color: white;"></i>
        <div class="loading-bar-container">
            <div class="loading-bar"></div>
        </div>
        <div class="loading-text">Memuat Game... <span id="loading-progress">0%</span></div>
    </div>

    <!-- Setup Screens -->
    <div class="setup-screen" id="main-character-setup">
        <div class="setup-form">
            <h2>Buat Karakter Utama</h2>
            <div class="form-group">
                <label for="main-name">Nama</label>
                <input type="text" id="main-name" class="form-control" placeholder="Masukkan nama karakter">
            </div>
            <div class="form-group">
                <label for="main-age">Umur</label>
                <input type="number" id="main-age" class="form-control" min="18" max="100" placeholder="Masukkan umur">
            </div>
            <label>Jenis Kelamin</label>
            <div class="gender-select">
                <div class="gender-option" data-gender="male">
                    <img src="/api/placeholder/120/120" alt="Pria">
                    <p>Pria</p>
                </div>
                <div class="gender-option" data-gender="female">
                    <img src="/api/placeholder/120/120" alt="Wanita">
                    <p>Wanita</p>
                </div>
            </div>
            <div class="setup-nav">
                <div></div> <!-- Empty div for spacing -->
                <button class="btn btn-primary" id="main-next">Selanjutnya</button>
            </div>
        </div>
    </div>

    <div class="setup-screen" id="partner-setup">
        <div class="setup-form">
            <h2>Buat Karakter Pasangan</h2>
            <div class="form-group">
                <label for="partner-name">Nama</label>
                <input type="text" id="partner-name" class="form-control" placeholder="Masukkan nama pasangan">
            </div>
            <div class="form-group">
                <label for="partner-age">Umur</label>
                <input type="number" id="partner-age" class="form-control" min="18" max="100" placeholder="Masukkan umur">
            </div>
            <div class="form-group">
                <label for="partner-gender">Jenis Kelamin</label>
                <input type="text" id="partner-gender" class="form-control" readonly>
            </div>
            <div class="setup-nav">
                <button class="btn btn-secondary" id="partner-back">Kembali</button>
                <button class="btn btn-primary" id="partner-next">Selanjutnya</button>
            </div>
        </div>
    </div>

    <!-- Welcome Screen -->
    <div id="welcome-screen" class="welcome-screen">
        <h1>Selamat Datang di Visual Novel</h1>
        <p>Selamat menikmati petualangan romansa dalam game ini. Setiap keputusan yang kamu ambil akan menentukan alur cerita dan akhir yang akan kamu dapatkan.</p>
        <video class="welcome-video" controls id="intro-video" muted>
            <source src="intro.mp4" type="video/mp4">
            Browser Anda tidak mendukung tag video.
        </video>
    </div>

    <!-- Main Game - Smartphone Interface -->
    <div class="smartphone">
        <div class="camera"></div>
        <div class="speaker"></div>
        <div class="content">
            <!-- Status Bar -->
            <div class="statusbar">
                <div class="time" id="current-time">00:00</div>
                <div class="info">
                    <span><i class="fas fa-battery-full"></i></span>
                    <span><i class="fas fa-wifi"></i></span>
                    <span><i class="fas fa-signal"></i></span>
                </div>
            </div>
            <div class="notification-container">
                <!-- Notifikasi akan ditampilkan di sini -->
            </div>

            <!-- App Grid -->
            <div class="app-grid">
                <div class="app-button" id="settings-button">
                    <i class="fas fa-cog"></i>
                    <div class="title">Pengaturan</div>
                </div>
                <div class="app-button" id="work-button">
                    <i class="fas fa-briefcase"></i>
                    <div class="title">Kerja</div>
                </div>
                <div class="app-button" id="notes-button">
                    <i class="fas fa-sticky-note"></i>
                    <div class="title">Catatan</div>
                </div>
                <div class="app-button" id="squegram-button">
                    <i class="fas fa-camera"></i>
                    <div class="title">Squegram</div>
                </div>
                <div class="app-button" id="memory-button">
                    <i class="fas fa-book"></i>
                    <div class="title">Ingatan</div>
                </div>
                <div class="app-button" id="chat-button">
                    <i class="fas fa-comment"></i>
                    <div class="title">Pesan</div>
                </div>
            </div>

            <!-- User Info -->
            <div class="user-info">
                <div class="left">
                    <div class="name" id="display-name">Nama Pengguna</div>
                    <div class="stats">
                        <div class="stat"><i class="fas fa-calendar-day"></i> <span id="current-date">01 Jan 2023</span></div>
                        <div class="stat"><i class="fas fa-bolt"></i> <span id="energy">100</span></div>
                    </div>
                </div>
                <div class="right">
                    <div class="stat"><i class="fas fa-coins"></i> <span id="money">1,000,000</span></div>
                </div>
            </div>

            <!-- Screens -->
            <div class="screen" id="settings-screen">
                <button class="back-button"><i class="fas fa-arrow-left"></i></button>
                <h2 class="screen-title">Pengaturan</h2>
                <div class="settings-option">
                    <div class="label">Suara</div>
                    <label class="toggle-switch">
                        <input type="checkbox" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-option">
                    <div class="label">Musik</div>
                    <label class="toggle-switch">
                        <input type="checkbox" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-option">
                    <div class="label">Notifikasi</div>
                    <label class="toggle-switch">
                        <input type="checkbox" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-option">
                    <div class="label">Mode Malam</div>
                    <label class="toggle-switch">
                        <input type="checkbox">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-option">
                    <div class="label">Bahasa</div>
                    <div class="value">Indonesia</div>
                </div>
            </div>

            <div class="screen" id="work-screen">
                <button class="back-button"><i class="fas fa-arrow-left"></i></button>
                <h2 class="screen-title">Pilih Pekerjaan</h2>
                <div class="job-list">
                    <!-- Job cards will be loaded from JSON -->
                </div>
            </div>

            <div class="screen" id="notes-screen">
                <button class="back-button"><i class="fas fa-arrow-left"></i></button>
                <h2 class="screen-title">Catatan</h2>
                <div class="notes-list">
                    <!-- Notes will be loaded from JSON -->
                </div>
                <div class="add-note-btn"><i class="fas fa-plus"></i></div>
            </div>

            <div class="screen" id="squegram-screen">
                <button class="back-button"><i class="fas fa-arrow-left"></i></button>
                <h2 class="screen-title">Squegram</h2>
                <div class="squegram-posts">
                    <!-- Posts will be loaded from JSON -->
                </div>
            </div>

            <div class="screen" id="memory-screen">
                <button class="back-button"><i class="fas fa-arrow-left"></i></button>
                <h2 class="screen-title">Ingatan</h2>
                <div class="memory-episodes">
                    <!-- Episodes will be loaded from JSON -->
                </div>
            </div>

            <div class="screen" id="chat-screen">
                <button class="back-button"><i class="fas fa-arrow-left"></i></button>
                <h2 class="screen-title">Pesan</h2>
                <ul class="messages-list">
                    <!-- Contacts will be loaded from JSON -->
                </ul>
            </div>

            <div class="screen" id="chat-detail-screen">
                <button class="back-button chat-back-btn"><i class="fas fa-arrow-left"></i></button>
                <div class="chat-container" id="active-chat">
                    <div class="chat-header">
                        <img src="/api/placeholder/40/40" alt="Avatar" class="chat-avatar" id="chat-contact-avatar">
                        <div class="chat-contact-name" id="chat-contact-name">Nama Kontak</div>
                    </div>
                    <div class="chat-messages" id="chat-messages">
                        <!-- Messages will be loaded from JSON -->
                    </div>
                    <div class="chat-choices-container" id="chat-choices-container">
                        <!-- Choices will be loaded from JSON -->
                    </div>
                    <div class="chat-input">
                        <input type="text" placeholder="Ketik pesan..." id="message-input">
                        <button id="send-message"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>

            <!-- Contact Identity Screen (New) -->
            <div class="screen" id="contact-identity-screen">
                <button class="back-button"><i class="fas fa-arrow-left"></i></button>
                <div class="contact-identity">
                    <img src="" id="identity-avatar" alt="">
                    <h2 id="identity-name"></h2>
                    <div class="details">
                        <div>Umur: <span id="identity-age"></span></div>
                        <div>Jenis Kelamin: <span id="identity-gender"></span></div>
                        <div>Deskripsi: <span id="identity-description"></span></div>
                    </div>
                    <div class="mood">
                        <div>Bahagia: <span id="identity-mood-happy"></span></div>
                        <div>Sedih: <span id="identity-mood-sad"></span></div>
                        <div>Marah: <span id="identity-mood-angry"></span></div>
                        <div>Cemburu: <span id="identity-mood-jealous"></span></div>
                    </div>
                </div>
            </div>

            <div class="screen" id="gallery-screen">
                <button class="back-button"><i class="fas fa-arrow-left"></i></button>
                <h2 class="screen-title">Galeri</h2>
                <div class="gallery-grid">
                    <!-- Gallery items will be loaded from JSON -->
                </div>
            </div>

            <!-- Navigation Bar -->
            <div class="navbar">
                <a href="#" class="nav-button active" id="nav-home">
                    <i class="fas fa-home"></i>
                    <span>Beranda</span>
                </a>
                <a href="#" class="nav-button" id="nav-messages">
                    <i class="fas fa-comment"></i>
                    <span>Pesan</span>
                </a>
                <a href="#" class="nav-button" id="nav-gallery">
                    <i class="fas fa-image"></i>
                    <span>Galeri</span>
                </a>
                <a href="#" class="nav-button" id="nav-exit">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Keluar</span>
                </a>
            </div>
        </div>
    </div>

    <script>
// Variabel global untuk menyimpan data game
const gameData = {
  mainCharacter: {
    name: "",
    age: 0,
    gender: "", // "male" / "female"
  },
  partner: {
    name: "",
    age: 0,
    gender: "", // "male" / "female"
  },
  jobs: [],
  contacts: [],
  conversations: {},
  notes: [],
  episodes: [],
  squegram: [],
  gallery: [],
  gameState: {
    currentScreen: "loading",
    currentChapter: 0,
    currentDialogIndex: 0,
    choices: [],
    visitedEpisodes: [],
    currentConversationIndex: {}, // Objek untuk menyimpan progress percakapan
  },
  stats: {
    money: 1000000,
    energy: 100,
    happiness: 80,
  },
};

// Fungsi untuk memuat file JSON
async function loadJsonData(filename) {
  try {
    const response = await fetch(`${filename}.json`);
    if (!response.ok) {
      throw new Error(`Failed to load ${filename}.json`);
    }
    return await response.json();
  } catch (error) {
    console.error(`Error loading ${filename}.json:`, error);
    return null;
  }
}

// Fungsi untuk memuat data game
async function loadGameData() {
  // Memuat semua data JSON yang diperlukan
  gameData.jobs = await loadJsonData("jobs") || [];
  gameData.contacts = await loadJsonData("contacts") || [];
  gameData.conversations = await loadJsonData("conversations") || {};
  gameData.notes = await loadJsonData("notes") || [];
  gameData.episodes = await loadJsonData("episodes") || [];
  gameData.squegram = await loadJsonData("squegram") || [];
  gameData.gallery = await loadJsonData("gallery") || [];
  // Inisialisasi progress percakapan
  gameData.contacts.forEach((contact) => {
    gameData.gameState.currentConversationIndex[contact.id] = 1; // Mulai dari percakapan 1
  });
  return true;
}

// Fungsi untuk mendapatkan waktu saat ini
function getCurrentTime() {
  const now = new Date();
  return `${now.getHours().toString().padStart(2, "0")}:${now.getMinutes().toString().padStart(2, "0")}`;
}

// Fungsi untuk memperbarui jam dan tanggal
function updateDateTime() {
  const now = new Date();
  const timeString = `${now.getHours().toString().padStart(2, "0")}:${now.getMinutes().toString().padStart(2, "0")}`;
  const dateString = now.toLocaleDateString("id-ID", {
    day: "2-digit",
    month: "short",
    year: "numeric",
  });
  document.getElementById("current-time").textContent = timeString;
  document.getElementById("current-date").textContent = dateString;
  // Perbarui tampilan pekerjaan berdasarkan waktu dan hari
  updateJobVisibility();
}

// Fungsi untuk menampilkan layar
function showScreen(screenId) {
  // Menyembunyikan semua layar
  document.querySelectorAll(".screen").forEach((screen) => {
    screen.classList.remove("active");
  });
  // Menampilkan layar yang dipilih
  document.getElementById(screenId).classList.add("active");
}

// Fungsi untuk memperbarui tombol navigasi aktif
function updateNavActive(activeButton) {
  document.querySelectorAll(".nav-button").forEach((button) => {
    button.classList.remove("active");
  });
  activeButton.classList.add("active");
}

// Fungsi untuk simulasi loading screen
function simulateLoading() {
  const loadingBar = document.querySelector(".loading-bar");
  const loadingProgress = document.getElementById("loading-progress");
  let progress = 0;
  const interval = setInterval(() => {
    progress += Math.floor(Math.random() * 5) + 1;
    if (progress >= 100) {
      progress = 100;
      clearInterval(interval);
      // Menyelesaikan loading
      setTimeout(() => {
        document.querySelector(".loading-screen").style.opacity = "0";
        setTimeout(() => {
          document.querySelector(".loading-screen").style.display = "none";
          document.getElementById("main-character-setup").style.display =
            "flex";
        }, 500);
      }, 500);
    }
    loadingBar.style.width = `${progress}%`;
    loadingProgress.textContent = `${progress}%`;
  }, 100);
}

// Fungsi untuk mengubah mood
function updateMood(contact, effect) {
  for (const mood in effect) {
    contact.mood[mood] += effect[mood];
  }
}

// Fungsi untuk memperbarui tampilan mood
function updateMoodDisplay(contact) {
  document.getElementById("identity-mood-happy").textContent =
    contact.mood.happy;
  document.getElementById("identity-mood-sad").textContent =
    contact.mood.sad;
  document.getElementById("identity-mood-angry").textContent =
    contact.mood.angry;
  document.getElementById("identity-mood-jealous").textContent =
    contact.mood.jealous;
}

// Fungsi untuk menampilkan contact identity (contact-identity.js)
function loadContactIdentity() {
  const params = new URLSearchParams(window.location.search);
  const contactId = params.get("contactId");
  const contact = gameData.contacts.find((c) => c.id === contactId);
  if (contact) {
    document.getElementById("identity-avatar").src = contact.avatar;
    document.getElementById("identity-name").textContent = contact.name;
    document.getElementById("identity-age").textContent = contact.age;
    document.getElementById("identity-gender").textContent = contact.gender;
    document.getElementById("identity-description").textContent =
      contact.description;
    // Tampilkan mood di halaman identitas
    updateMoodDisplay(contact);
  }
}

// Panggil loadContactIdentity() saat halaman contact identity dimuat
window.addEventListener("DOMContentLoaded", loadContactIdentity);

// Fungsi untuk menutup dialog visual novel
function closeVisualNovel() {
  const dialogContainer = document.getElementById("dialog-container");
  const choicesContainer = document.getElementById("chat-choices-container");
  dialogContainer.style.display = "none";
  choicesContainer.style.display = "none";
}

// Efek mengetik (typeWriterEffect)
function typeWriterEffect(element, text, callback) {
  let i = 0;
  const typingInterval = 50; // Kecepatan mengetik
  const interval = setInterval(() => {
    if (i < text.length) {
      element.textContent += text.charAt(i);
      i++;
    } else {
      clearInterval(interval);
      callback();
    }
  }, typingInterval);
}

// Fungsi untuk menambahkan catatan ke notes.json dan menampilkannya
function addNoteToNotes(noteId) {
  const note = gameData.notes.find((n) => n.id === noteId);
  if (note) {
    // Tambahkan catatan ke notes.json (jika sudah ada, skip)
    if (!gameData.notes.find((n) => n.id === note.id)) {
      gameData.notes.push(note);
    }
    // Render catatan ke layar
    renderNotes();
  }
}

// **Fungsi untuk menampilkan catatan**
function renderNotes() {
  const notesList = document.getElementById("notes-list");
  notesList.innerHTML = "";
  if (!gameData.notes || gameData.notes.length === 0) {
    notesList.innerHTML = '<div>Tidak ada catatan.</div>';
    return;
  }
  gameData.notes.forEach((note) => {
    const noteItem = document.createElement("div");
    noteItem.className = "note-item";
    noteItem.innerHTML = `
      <div class="note-title">${note.title}</div>
      <div class="note-content">${note.content}</div>
      <div class="note-details">
        <span class="note-date">${note.date}</span>
      </div>
    `;
    notesList.appendChild(noteItem);
  });
}

// **Fungsi untuk menambahkan catatan baru**
function addNewNote() {
  const noteTitle = prompt("Masukkan judul catatan:");
  if (!noteTitle) return;
  const noteContent = prompt("Masukkan isi catatan:");
  if (!noteContent) return;
  const newNote = {
    id: Date.now().toString(),
    title: noteTitle,
    content: noteContent,
    date: new Date().toLocaleDateString("id-ID"),
  };
  gameData.notes.push(newNote);
  renderNotes();
  saveNotesToJson(); // Panggil fungsi untuk menyimpan catatan
}

// **Fungsi untuk menyimpan catatan ke notes.json**
async function saveNotesToJson() {
  try {
    const notesData = await loadJsonData("notes");
    if (!notesData) {
      return; // File notes.json belum ada, tidak perlu simpan
    }
    const response = await fetch("notes.json", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(notesData),
    });
    if (!response.ok) {
      throw new Error(`Failed to save notes to notes.json`);
    }
    console.log("Catatan berhasil disimpan ke notes.json");
  } catch (error) {
    console.error(`Error saving notes to notes.json:`, error);
  }
}

// Fungsi untuk menampilkan notifikasi
function showNotification(contactId, conversationIndex) {
  const contact = gameData.contacts.find((c) => c.id === contactId);
  if (!contact) return;

  const conversation =
    gameData.conversations[contactId].conversations[conversationIndex];
  if (!conversation) return;

  // Dapatkan teks notifikasi dari data JSON
  const notificationText = conversation.notification;

  if (notificationText) {
    const notificationContainer = document.getElementById(
      "notification-container"
    );
    const notification = document.createElement("div");
    notification.className = "notification";
    notification.textContent = notificationText;
    // Menambahkan tombol "Tutup"
    const closeBtn = document.createElement("button");
    closeBtn.textContent = "Tutup";
    closeBtn.addEventListener("click", () => {
      notificationContainer.removeChild(notification);
    });
    notification.appendChild(closeBtn);
    notificationContainer.appendChild(notification);
  }
}

// Fungsi untuk memperbarui statistik
function updateStats() {
  document.getElementById("money").textContent =
    gameData.stats.money.toLocaleString();
  document.getElementById("energy").textContent = gameData.stats.energy;
  // ... (Perbarui statistik lainnya)
}

// Fungsi untuk menampilkan notifikasi baru
function showNotifications() {
  for (const contactId in gameData.conversations) {
    const conversations = gameData.conversations[contactId].conversations;
    for (const conversationIndex in conversations) {
      if (
        conversationIndex >
        gameData.gameState.currentConversationIndex[contactId]
      ) {
        showNotification(contactId, parseInt(conversationIndex));
      }
    }
  }
}

// Inisialisasi aplikasi
async function initApp() {
  try {
    await loadGameData();
    simulateLoading();
    // Set interval untuk updateDateTime
    setInterval(updateDateTime, 60000); // Perbarui setiap menit
  } catch (error) {
    console.error("Error initializing app:", error);
    // Jika terjadi kesalahan, tetap lanjutkan ke layar setup
    simulateLoading();
  }
}

window.addEventListener("DOMContentLoaded", () => {
  console.log("DOM telah dimuat, memulai aplikasi...");
  initApp()
    .then(() => {
      console.log("Aplikasi telah diinisialisasi");
      showNotifications();
    })
    .catch((error) => {
      console.error("Gagal memulai aplikasi:", error);
    });
});

// Fungsi untuk merender pesan
function renderMessages() {
  const messagesList = document.querySelector(".messages-list");
  messagesList.innerHTML = "";

  if (!gameData.contacts || gameData.contacts.length === 0) {
    messagesList.innerHTML = '<li>Tidak ada kontak yang tersedia.</li>';
    return;
  }

  gameData.contacts.forEach((contact) => {
    const contactDiv = document.createElement("div");
    contactDiv.className = "contact-item";
    contactDiv.setAttribute("data-id", contact.id);

    // Mencari percakapan terakhir (jika ada)
    const conversation = gameData.conversations[contact.id] || { messages: [] };
    const lastMessage =
      conversation.messages.length > 0
        ? conversation.messages[conversation.messages.length - 1]
        : { text: "Belum ada pesan", time: "" };

    contactDiv.innerHTML = `
      <img src="${contact.avatar}" alt="${contact.name}" class="contact-avatar">
      <div class="contact-details">
        <div class="contact-name">${contact.name}</div>
        <div class="contact-last-message">${lastMessage.text}</div>
        <div class="contact-last-message-time">${lastMessage.time}</div>
      </div>
    `;

    // Event Listener untuk klik kontak
    contactDiv.addEventListener("click", () => openContactIdentity(contact.id));

    messagesList.appendChild(contactDiv);
  });
}

// Fungsi untuk membuka halaman identitas kontak
function openContactIdentity(contactId) {
  const contact = gameData.contacts.find((c) => c.id === contactId);
  if (!contact) return;

  // Menampilkan layar identitas
  document.getElementById("chat-screen").classList.remove("active");
  document.getElementById("contact-identity-screen").classList.add("active");

  // Mengatur informasi kontak
  document.getElementById("identity-avatar").src = contact.avatar;
  document.getElementById("identity-name").textContent = contact.name;
  document.getElementById("identity-age").textContent = contact.age;
  document.getElementById("identity-gender").textContent = contact.gender;
  document.getElementById("identity-description").textContent =
    contact.description;

  updateMoodDisplay(contact);
}

// Fungsi untuk menampilkan pesan dalam chat
function renderChatMessages(contactId) {
  const chatMessages = document.getElementById("chat-messages");
  chatMessages.innerHTML = "";

  const conversation = gameData.conversations[contactId];

  if (!conversation || conversation.messages.length === 0) {
    chatMessages.innerHTML = '<div class="no-messages">Belum ada pesan.</div>';
    return;
  }

  conversation.messages.forEach((message) => {
    const messageDiv = document.createElement("div");
    messageDiv.className = `message ${
      message.sender === "user" ? "sent" : "received"
    }`;
    messageDiv.innerHTML = `
      <div class="message-bubble">
        ${message.text}
        <div class="message-time">${message.time}</div>
      </div>
    `;
    chatMessages.appendChild(messageDiv);
  });

  // Scroll ke pesan terbaru
  chatMessages.scrollTop = chatMessages.scrollHeight;

  // Mengaktifkan fungsi kirim pesan
  setupMessageSending(contactId);
}

// Fungsi untuk mengirim pesan
function setupMessageSending(contactId) {
  const messageInput = document.getElementById("message-input");
  const sendButton = document.getElementById("send-message");

  // Hapus event listener lama (jika ada)
  sendButton.removeEventListener("click", sendMessage);

  // Menambahkan event listener baru
  sendButton.addEventListener("click", sendMessage);

  // Menambahkan event listener untuk tombol Enter
  messageInput.addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
      sendButton.click();
    }
  });

  // Fungsi untuk mengirim pesan
  function sendMessage() {
    const messageText = messageInput.value.trim();
    if (messageText === "") return;

    // Membuat objek pesan baru
    const newMessage = {
      sender: "user",
      text: messageText,
      time: getCurrentTime(),
    };

    // Menambahkan pesan ke data percakapan
    if (!gameData.conversations[contactId]) {
      gameData.conversations[contactId] = { messages: [] };
    }
    gameData.conversations[contactId].messages.push(newMessage);

    // Menampilkan pesan baru
    renderChatMessages(contactId);

    // Mengosongkan input
    messageInput.value = "";

    // Menambahkan respons otomatis (simulasi)
    setTimeout(() => {
      // Mengambil respons dari NPC dari data json yang dimuat
      const npcResponses =
        gameData.conversations[contactId].possibleResponses || [
          "Baik, saya mengerti.",
        ];
      const randomIndex = Math.floor(Math.random() * npcResponses.length);
      const npcMessage = {
        sender: "contact",
        text: npcResponses[randomIndex],
        time: getCurrentTime(),
      };
      gameData.conversations[contactId].messages.push(npcMessage);
      renderChatMessages(contactId);
    }, 1000);
  }
}

// Fungsi untuk menampilkan dialog percakapan
function showConversation(contactId, conversationIndex) {
  const contact = gameData.contacts.find((c) => c.id === contactId);
  if (!contact) return;

  const conversation =
    gameData.conversations[contactId].conversations[conversationIndex];
  if (!conversation) return;

  // Mengatur background
  if (conversation.background) {
    document.getElementById("visual-novel-screen").style.backgroundImage =
      `url('${conversation.background}')`;
  }

  // Menampilkan dialog
  const dialogContainer = document.getElementById("dialog-container");
  const dialogName = document.getElementById("dialog-name");
  const dialogText = document.getElementById("dialog-text");
  dialogName.textContent = conversation.speaker;

  // Efek mengetik untuk dialog
  typeWriterEffect(dialogText, conversation.text, () => {
    // Setelah dialog selesai, periksa apakah ada pilihan
    if (conversation.choices && conversation.choices.length > 0) {
      showChoices(
        conversation.choices,
        contactId,
        conversationIndex
      ); // Pass contactId dan conversationIndex
    } else {
      // Jika tidak ada pilihan, siapkan untuk dialog berikutnya
      dialogContainer.onclick = () =>
        nextConversation(contactId, conversationIndex);
    }
  });

  dialogContainer.style.display = "block";

  // Panggil fungsi showJobsGradually() setelah dialog ditampilkan
  showJobsGradually(contactId, conversationIndex);

  // Periksa apakah ada pekerjaan yang baru dibuka
  if (conversation.openJobs && conversation.openJobs.length > 0) {
    // Tampilkan notifikasi pekerjaan
    showJobNotifications(conversation.openJobs);
  }

  // Periksa apakah ada catatan yang harus ditambahkan
  if (conversation.addNotes && conversation.addNotes.length > 0) {
    // Tambahkan catatan ke notes.json
    conversation.addNotes.forEach((noteId) => {
      addNoteToNotes(noteId);
    });
  }

  // Periksa apakah percakapan ini memicu upload Squegram
  if (conversation.uploadSquegram && conversation.uploadSquegram.length > 0) {
    const squegramData = conversation.uploadSquegram[0]; // Ambil data Squegram pertama
    uploadSquegram(squegramData.contactId, squegramData.squegramId);
  }

  // Periksa apakah ada episode yang terkait dengan percakapan ini
  const episode = gameData.episodes[conversationIndex];
  if (episode) {
    const episodeSeparator = document.getElementById("episode-separator");
    episodeSeparator.setAttribute("data-episode-id", episode.id);
    episodeSeparator.innerHTML = `
      <h3>${episode.title}</h3>
      <p>${episode.description}</p>
    `;
    episodeSeparator.style.display = "block";
  }
  // Render konten episode jika tersedia
  renderEpisodeContent(conversationIndex);
  gameData.gameState.currentDialogIndex = conversationIndex; // Update progress dialog
}

// Fungsi untuk menampilkan pilihan
function showChoices(choices, contactId, conversationIndex) {
  const choicesContainer = document.getElementById("chat-choices-container");
  choicesContainer.innerHTML = "";

  choices.forEach((choice) => {
    const choiceBtn = document.createElement("button");
    choiceBtn.className = "choice-btn";
    choiceBtn.textContent = choice.text;
    choiceBtn.addEventListener("click", () => {
      // Menyimpan pilihan
      gameData.gameState.choices.push({
        contactId: contactId, // Simpan contactId
        conversationIndex: conversationIndex, // Simpan conversationIndex
        choiceId: choice.id,
      });
      // Beralih ke dialog berikutnya berdasarkan pilihan
      if (choice.nextConversation !== undefined) {
        // Simpan progress percakapan
        saveConversationProgress(contactId, choice.nextConversation);
        // Lanjutkan ke dialog berikutnya
        showConversation(contactId, choice.nextConversation);
      } else {
        closeVisualNovel();
      }
    });
    choicesContainer.appendChild(choiceBtn);
  });

  choicesContainer.style.display = "block";
}

// Fungsi untuk merender Squegram
function renderSquegram() {
  const postsContainer = document.querySelector(".squegram-posts");
  postsContainer.innerHTML = "";

  if (!gameData.squegram || gameData.squegram.length === 0) {
    postsContainer.innerHTML = '<div>Tidak ada postingan.</div>';
    return;
  }

  const now = new Date();
  gameData.squegram.forEach((post) => {
    if (
      post.isTemporary &&
      now.getTime() > post.expiryDate.getTime()
    ) {
      // Postingan sementara telah expired
      // Hapus postingan dari gameData.squegram
      gameData.squegram = gameData.squegram.filter(
        (p) => p.id !== post.id
      );
      renderSquegram(); // Render ulang Squegram
      saveSquegramToJson(); // Simpan data Squegram ke file JSON
    } else {
      const postDiv = document.createElement("div");
      postDiv.className = "squegram-post";
      postDiv.innerHTML = `
        <div class="header">
          <img src="${post.avatar}" alt="${post.username}" class="avatar">
          <div class="username">${post.username}</div>
        </div>
        <img src="${post.image}" alt="Post" class="image">
        <div class="actions">
          <i class="fas fa-heart action-btn" data-id="${post.id}"></i>
          <i class="fas fa-comment action-btn"></i>
          <i class="fas fa-paper-plane action-btn"></i>
        </div>
        <div class="likes">${post.likes} suka</div>
        <div class="caption"><strong>${post.username}</strong> ${post.caption}</div>
      `;
      postsContainer.appendChild(postDiv);
    }
  });

  // Event listener untuk tombol like
  document.querySelectorAll(".fa-heart").forEach((button) => {
    button.addEventListener("click", (e) => {
      const postId = e.target.getAttribute("data-id");
      const post = gameData.squegram.find((p) => p.id === postId);
      if (post) {
        post.likes++;
        renderSquegram();
        saveSquegramToJson(); // Simpan data Squegram ke file JSON
      }
    });
  });
}

// **Fungsi untuk menyimpan data Squegram ke squegram.json**
async function saveSquegramToJson() {
  try {
    const response = await fetch("squegram.json", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(gameData.squegram),
    });
    if (!response.ok) {
      throw new Error(`Failed to save squegram to squegram.json`);
    }
    console.log("Squegram berhasil disimpan ke squegram.json");
  } catch (error) {
    console.error(`Error saving squegram to squegram.json:`, error);
  }
}

// **Fungsi untuk menampilkan catatan**
function renderNotes() {
  const notesList = document.getElementById("notes-list");
  notesList.innerHTML = "";
  if (!gameData.notes || gameData.notes.length === 0) {
    notesList.innerHTML = '<div>Tidak ada catatan.</div>';
    return;
  }
  gameData.notes.forEach((note) => {
    const noteItem = document.createElement("div");
    noteItem.className = "note-item";
    noteItem.innerHTML = `
      <div class="note-title">${note.title}</div>
      <div class="note-content">${note.content}</div>
      <div class="note-details">
        <span class="note-date">${note.date}</span>
      </div>
    `;
    notesList.appendChild(noteItem);
  });
}

// **Fungsi untuk menambahkan catatan baru**
function addNewNote() {
  const noteTitle = prompt("Masukkan judul catatan:");
  if (!noteTitle) return;
  const noteContent = prompt("Masukkan isi catatan:");
  if (!noteContent) return;
  const newNote = {
    id: Date.now().toString(),
    title: noteTitle,
    content: noteContent,
    date: new Date().toLocaleDateString("id-ID"),
  };
  gameData.notes.push(newNote);
  renderNotes();
  saveNotesToJson(); // Panggil fungsi untuk menyimpan catatan
}

// **Fungsi untuk menyimpan catatan ke notes.json**
async function saveNotesToJson() {
  try {
    const notesData = await loadJsonData("notes");
    if (!notesData) {
      return; // File notes.json belum ada, tidak perlu simpan
    }
    const response = await fetch("notes.json", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(notesData),
    });
    if (!response.ok) {
      throw new Error(`Failed to save notes to notes.json`);
    }
    console.log("Catatan berhasil disimpan ke notes.json");
  } catch (error) {
    console.error(`Error saving notes to notes.json:`, error);
  }
}

// Fungsi untuk merender pekerjaan
function renderJobs() {
  const jobList = document.querySelector(".job-list");
  jobList.innerHTML = "";

  if (!gameData.jobs || gameData.jobs.length === 0) {
    jobList.innerHTML = '<div>Tidak ada pekerjaan yang tersedia.</div>';
    return;
  }

  gameData.jobs.forEach((job) => {
    const jobCard = document.createElement("div");
    jobCard.className = "job-card";
    jobCard.setAttribute("data-id", job.id);
    jobCard.innerHTML = `
      <div class="title">${job.title}</div>
      <div class="description">${job.description}</div>
      <div class="details">
        <span class="salary">Rp ${job.salary.toLocaleString()}</span>
        <span class="energy">Energi: -${job.energyCost}</span>
      </div>
      <button class="btn-work" data-id="${job.id}">Ambil Pekerjaan</button>
    `;

    // Menambahkan event listener untuk tombol pekerjaan
    jobCard.querySelector(".btn-work").addEventListener("click", () => {
      const jobId = jobCard.querySelector(".btn-work").getAttribute("data-id");
      doJob(jobId);
    });

    jobList.appendChild(jobCard);
  });

  // Perbarui visibilitas pekerjaan berdasarkan waktu dan hari
  updateJobVisibility();
}

// Fungsi untuk memperbarui visibilitas pekerjaan
function updateJobVisibility() {
  const now = new Date();
  const currentHour = now.getHours();
  const currentDay = now.getDay();

  // Loop melalui setiap pekerjaan
  gameData.jobs.forEach((job) => {
    const jobCard = document.querySelector(`.job-card[data-id="${job.id}"]`);
    if (jobCard) {
      // Jika pekerjaan memiliki durasi, hari, atau batas waktu
      if (job.duration || job.days || job.startTime || job.endTime) {
        // Periksa kondisi pekerjaan
        if (
          (job.duration && job.duration <= 0) ||
          (job.days && !job.days.includes(currentDay)) ||
          (job.startTime && job.endTime &&
            (currentHour < job.startTime || currentHour > job.endTime))
        ) {
          // Sembunyikan job card
          jobCard.style.display = "none";
        } else {
          // Tampilkan job card
          jobCard.style.display = "block";
        }
      }
    }
  });
}

// Fungsi untuk merender episode memori
function renderMemoryEpisodes() {
  const episodesContainer = document.querySelector(".memory-episodes");
  episodesContainer.innerHTML = "";
  if (!gameData.episodes || gameData.episodes.length === 0) {
    episodesContainer.innerHTML = '<div>Tidak ada episode yang tersedia.</div>';
    return;
  }
  gameData.episodes.forEach((episode) => {
    const episodeCard = document.createElement("div");
    episodeCard.className = "memory-episode";
    episodeCard.setAttribute("data-id", episode.id);
    episodeCard.innerHTML = `
      <div class="title">${episode.title}</div>
      <div class="description">${episode.description}</div>
    `;
    // Event Listener untuk klik episode
    episodeCard.addEventListener("click", () => renderEpisodeContent(episode.id));
    episodesContainer.appendChild(episodeCard);
  });
}

// Fungsi untuk merender konten episode (perubahan)
function renderEpisodeContent(conversationIndex) {
  const episode = gameData.episodes[conversationIndex];
  if (episode) {
    // Jika ada properti content_text, gunakan itu
    if (episode.content.content_text) {
      document.getElementById("episode-content-display").innerHTML = episode.content.content_text; 
    } else if (episode.content.url_content) {
      // Jika ada properti url_content, gunakan itu
      document.getElementById("episode-content-display").innerHTML = episode.content.url_content; 
    }
    // Update visitedEpisodes
    if (!gameData.gameState.visitedEpisodes.includes(episode.id)) {
      gameData.gameState.visitedEpisodes.push(episode.id);
    }
  }
}


// Fungsi untuk memperbarui statistik
function updateStats() {
  document.getElementById("money").textContent =
    gameData.stats.money.toLocaleString();
  document.getElementById("energy").textContent = gameData.stats.energy;
  // ... (Perbarui statistik lainnya)
}

// Fungsi untuk menampilkan notifikasifunction
function showNotifications() {
  for (const contactId in gameData.conversations) {
    const conversations = gameData.conversations[contactId].conversations;
    for (const conversationIndex in conversations) {
      if (
        conversationIndex >
        gameData.gameState.currentConversationIndex[contactId]
      ) {
        showNotification(contactId, parseInt(conversationIndex));
      }
    }
  }
}

// Fungsi untuk menampilkan pekerjaan secara bertahap
function showJobsGradually(conversationId, conversationIndex) {
  const conversation =
    gameData.conversations[conversationId].conversations[conversationIndex];
  // Memeriksa apakah percakapan ini memicu pembukaan pekerjaan
  if (conversation.openJobs && conversation.openJobs.length > 0) {
    // Mencari data pekerjaan yang harus dibuka
    const jobsToOpen = conversation.openJobs.map((jobId) =>
      gameData.jobs.find((job) => job.id === jobId)
    );
    // Menampilkan pekerjaan baru
    jobsToOpen.forEach((job) => {
      // Periksa apakah job sudah ada di gameData.jobs
      if (!gameData.jobs.find((j) => j.id === job.id)) {
        // Tambah job ke data gameData.jobs
        gameData.jobs.push(job);
        // Render pekerjaan baru
        const jobCard = document.createElement("div");
        jobCard.className = "job-card";
        jobCard.setAttribute("data-id", job.id); // Tambahkan data-id
        jobCard.innerHTML = `
          <div class="title">${job.title}</div>
          <div class="description">${job.description}</div>
          <div class="details">
            <span class="salary">Rp ${job.salary.toLocaleString()}</span>
            <span class="energy">Energi: -${job.energyCost}</span>
          </div>
          <button class="btn-work" data-id="${job.id}">Ambil Pekerjaan</button>
        `;
        document.querySelector(".job-list").appendChild(jobCard);
        // Menambahkan event listener untuk tombol pekerjaan baru
        jobCard.querySelector(".btn-work").addEventListener("click", () => {
          const jobId = jobCard.querySelector(".btn-work").getAttribute(
            "data-id"
          );
          doJob(jobId);
        });
      }
    });
  }
}

// Fungsi untuk menampilkan notifikasi pekerjaan
function showJobNotifications(jobIds) {
  // Loop melalui setiap ID pekerjaan
  jobIds.forEach((jobId) => {
    const job = gameData.jobs.find((j) => j.id === jobId);
    if (job) {
      // Dapatkan teks notifikasi berdasarkan waktu dan hari pekerjaan
      const notificationText = getJobNotificationText(job);
      if (notificationText) {
        // Tampilkan notifikasi
        showNotification(null, notificationText); // Tidak perlu contactId
      }
    }
  });
}

// Fungsi untuk mendapatkan teks notifikasi pekerjaan
function getJobNotificationText(job) {
  const now = new Date();
  const currentDay = now.getDay();

  let notificationText = "";

  // Jika pekerjaan memiliki durasi, hari, atau batas waktu
  if (job.duration || job.days || job.startTime || job.endTime) {
    // Periksa kondisi pekerjaan
    if (
      (job.duration && job.duration <= 0) ||
      (job.days && !job.days.includes(currentDay)) ||
      (job.startTime && job.endTime &&
        (now.getHours() < job.startTime || now.getHours() > job.endTime))
    ) {
      // Pekerjaan tidak tersedia
      // Tidak perlu menampilkan notifikasi
    } else {
      // Pekerjaan tersedia
      notificationText = `Pekerjaan "${job.title}" tersedia!`;
    }
  } else {
    // Pekerjaan tersedia (tidak memiliki durasi, hari, atau batas waktu)
    notificationText = `Pekerjaan "${job.title}" tersedia!`;
  }

  return notificationText;
}

// Fungsi untuk pindah ke dialog berikutnya
function nextConversation(contactId, conversationIndex) {
  const nextConversationIndex = conversationIndex + 1;

  // Periksa apakah ada percakapan berikutnya
  if (
    gameData.conversations[contactId].conversations[nextConversationIndex]
  ) {
    showConversation(contactId, nextConversationIndex);
    saveConversationProgress(contactId, nextConversationIndex);
  } else {
    // Tutup dialog
    closeVisualNovel();
  }
}

// Fungsi untuk menyimpan progress percakapan
function saveConversationProgress(contactId, conversationIndex) {
  gameData.gameState.currentConversationIndex[contactId] = conversationIndex;
}

// Fungsi untuk merender galeri
function renderGallery() {
  const galleryGrid = document.querySelector(".gallery-grid");
  galleryGrid.innerHTML = "";
  if (!gameData.gallery || gameData.gallery.length === 0) {
    galleryGrid.innerHTML = "<div>Tidak ada item galeri.</div>";
    return;
  }
  gameData.gallery.forEach((item) => {
    const galleryItem = document.createElement("div");
    galleryItem.className = "gallery-item";
    galleryItem.innerHTML = `<img src="${item.image}" alt="${item.title}">`;
    galleryGrid.appendChild(galleryItem);
  });
}

// Fungsi untuk melakukan pekerjaan (dengan penambahan kondisi)
function doJob(jobId) {
  const job = gameData.jobs.find((j) => j.id === jobId);
  if (!job) {
    console.error("Pekerjaan tidak ditemukan:", jobId);
    return;
  }
  // Memeriksa energi
  if (gameData.stats.energy < job.energyCost) {
    alert("Energi tidak cukup untuk pekerjaan ini!");
    return;
  }
  // Memeriksa kondisi pekerjaan (durasi, hari, batas waktu, dan jumlah maksimal)
  const today = new Date().getDay();
  const now = new Date();
  const currentHour = now.getHours();

  if (job.duration && job.duration <= 0) {
    removeJob(jobId);
    alert("Pekerjaan ini sudah berakhir!");
    return;
  }
  if (job.days && !job.days.includes(today)) {
    removeJob(jobId);
    alert("Pekerjaan ini tidak tersedia hari ini!");
    return;
  }
  if (job.startTime && job.endTime && (currentHour < job.startTime || currentHour > job.endTime)) {
    removeJob(jobId);
    alert("Pekerjaan ini tidak tersedia pada waktu ini!");
    return;
  }
  if (job.maxAttempts && job.maxAttempts <= 0) {
    removeJob(jobId);
    alert("Pekerjaan ini sudah mencapai batas percobaan!");
    return;
  }

  // Mengurangi energi dan menambah uang
  gameData.stats.energy -= job.energyCost;
  gameData.stats.money += job.salary;
  // Memperbarui tampilan
  updateStats();
  // Menampilkan pesan sukses
  alert(`Pekerjaan selesai! Kamu mendapatkan Rp ${job.salary.toLocaleString()}`);
  // Update display
  updateJobDisplay(jobId);

  // Kurangi durasi atau percobaan maksimal jika ada
  if (job.duration) job.duration--;
  if (job.maxAttempts) job.maxAttempts--;
}

// Fungsi untuk menghapus pekerjaan
function removeJob(jobId) {
  gameData.jobs = gameData.jobs.filter((job) => job.id !== jobId);
  const jobCard = document.querySelector(`.job-card[data-id="${jobId}"]`);
  if (jobCard) jobCard.remove();
}

// Fungsi untuk memperbarui tampilan pekerjaan
function updateJobDisplay(jobId) {
  const job = gameData.jobs.find((j) => j.id === jobId);
  if (!job) return;
  const jobCard = document.querySelector(`.job-card[data-id="${jobId}"]`);
  if (jobCard) {
    jobCard.querySelector(".details .energy").textContent = `Energi: -${job.energyCost}`;
    jobCard.querySelector(".details .salary").textContent = `Rp ${job.salary.toLocaleString()}`;
    if (job.duration && job.duration <= 0) {
      jobCard.querySelector(".btn-work").disabled = true;
      jobCard.querySelector(".btn-work").textContent = "Selesai";
    }
    if (job.maxAttempts && job.maxAttempts <= 0) {
      jobCard.querySelector(".btn-work").disabled = true;
      jobCard.querySelector(".btn-work").textContent = "Batas Percobaan Tercapai";
    }
    if (job.days && !job.days.includes(new Date().getDay())) {
      jobCard.style.display = "none";
    }
    if (job.startTime && job.endTime) {
      const now = new Date();
      const currentHour = now.getHours();
      if (currentHour < job.startTime || currentHour > job.endTime) {
        jobCard.style.display = "none";
      }
    }
  }
}

// Fungsi untuk mengunggah Squegram
function uploadSquegram(contactId, squegramId) {
  const squegramPost = gameData.squegram.find(
    (post) => post.id === squegramId
  );
  if (squegramPost) {
    // Squegram sudah ada, update informasi
    // ... (Logika untuk memperbarui informasi Squegram)
  } else {
    // Squegram belum ada, buat baru
    const contact = gameData.contacts.find(
      (c) => c.id === contactId
    );
    if (contact) {
      //  Ganti dengan logika untuk mendapatkan gambar/foto dari user
      const imageURL = `https://www.ciciai.com/api/placeholder/400/200`; // Contoh placeholder
      const newSquegramPost = {
        id: squegramId,
        username: contact.name,
        avatar: contact.avatar,
        image: imageURL,
        caption: contact.name + " baru saja mengunggah foto",
        likes: 0,
        isTemporary: false, // Atur menjadi true jika postingan sementara
        expiryDate: new Date(
          new Date().getTime() + 1000 * 60 * 60 * 24 // Atur durasi ekspirasi
        ), // Atur waktu ekspirasi jika sementara
      };
      gameData.squegram.push(newSquegramPost);
      renderSquegram();
      saveSquegramToJson(); // Simpan data Squegram ke file JSON
    }
  }
}
    </script>
</body>
</html>
